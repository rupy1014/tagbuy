# Spec: 003-payment

## Feature Name
PG 결제 + 에스크로 자동 예치

## User Value (고객 가치)
- 원클릭 5초 결제로 캠페인 즉시 시작
- 투명한 수수료 구조 (에스크로 0.5% + PG 실비)
- PG 수수료 부담 주체 선택 가능
- 에스크로로 안전한 거래 보장

## Target User (누가 쓸까?)
- Primary: 광고주
- Use case: 캠페인 예산 결제 및 에스크로 예치

## User Journey & Screen Flow

### 1. 결제 화면
- **UI Elements**:
  - 결제 금액 요약 (캠페인 예산, 에스크로 수수료, PG 수수료)
  - PG 수수료 부담 선택 (광고주/인플루언서)
  - 결제 수단 선택 (저장된 카드, 새 카드, 가상계좌)
  - 실시간 총 비용 계산
- **CTA**: "결제하기"
- **Next**: 결제 처리 → 완료 화면

### 2. 결제 수단 등록
- **UI Elements**: 카드 정보 입력 폼, 가상계좌 발급 안내
- **CTA**: "카드 등록", "가상계좌 발급"
- **Next**: 결제 화면

### 3. 결제 완료
- **UI Elements**: 결제 완료 메시지, 에스크로 예치 확인, 캠페인 상태 업데이트
- **CTA**: "캠페인으로 이동", "결제 내역 확인"
- **Next**: 캠페인 상세 (002-campaign)

### 4. 결제 내역
- **UI Elements**: 결제 목록 (날짜, 캠페인명, 금액, 상태), 영수증 다운로드
- **CTA**: "영수증 발급", "환불 요청"
- **Next**: 상세 영수증 페이지

## Business Rules

### 수수료 구조
- 에스크로 수수료: 0.5% (TagBuy 수익)
- PG 수수료:
  - 카드: 2.5-3% (실비)
  - 가상계좌: 0.3-0.5% (실비)

### PG 수수료 부담 옵션
- **광고주 부담**: 광고주가 캠페인 예산 + 에스크로 + PG 수수료 전액 지불, 인플루언서 100% 수령
- **인플루언서 부담**: 광고주는 캠페인 예산 + 에스크로만 지불, PG 수수료는 인플루언서 정산 시 차감

### 결제 프로세스
1. 결제 요청 → 자체 PG 처리
2. 결제 성공 → 에스크로 자동 예치
3. 캠페인 활성화
4. 외부 PG 리다이렉트 없음 (자체 PG)

### 환불 정책
- 캠페인 시작 전: 100% 환불 (PG 수수료 제외)
- 캠페인 진행 중: 미집행 금액 환불
- 분쟁 발생 시: 중재 절차 후 판정에 따라 처리

## Edge Cases
- 결제 실패: 재시도 안내, 다른 결제 수단 제안
- 카드 한도 초과: 분할 결제 불가, 다른 수단 안내
- 가상계좌 미입금: 24시간 내 미입금 시 자동 취소
- 중복 결제: 자동 감지 후 중복분 환불

## Dependencies
- 자체 PG 시스템
- 에스크로 시스템
- 002-campaign (캠페인 상태 연동)
- 006-settlement (정산 연동)

---

💡 **더 구체화하려면**: `/appkit.ui`, `/appkit.policy` 실행
